<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAINS - ê³ ë ¤ëŒ€í•™êµ ìŠ¤í¬ì¸  í†µê³„ë¶„ì„ ë™ì•„ë¦¬</title>
    <style>
        /* ============================ */
        /* [1] í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì •        */
        /* ============================ */
        @font-face {
            font-family: 'KBO_Dia';
            src: url('KBO_medium.woff') format('woff');
            font-weight: normal; font-style: normal;
        }
        @font-face {
            font-family: 'SCDream';
            src: url('SCDream5.otf');
            font-weight: normal; font-style: normal;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'SCDream', sans-serif; line-height: 1.6; color: #333; }
        h1, h3 { font-family: 'KBO_Dia', sans-serif; }

        /* ============================ */
        /* [2] ë ˆì´ì•„ì›ƒ ë° í—¤ë”         */
        /* ============================ */
        header { 
            background-color: #cf8b8b; 
            color: white; 
            padding: 1rem 2rem; 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            position: relative;
            z-index: 1000;
        }
        
        .hamburger-btn {
            display: flex; flex-direction: column; justify-content: space-between;
            width: 24px; height: 18px; cursor: pointer; z-index: 1100;
        }
        .hamburger-btn span {
            display: block; width: 100%; height: 2px;
            background-color: white; border-radius: 3px; transition: all 0.3s ease;
        }

        header h1 { font-size: 1.5rem; font-weight: bold; margin: 0; }
        header h1 a { text-decoration: none; color: white; }
        header nav { display: none; } 

        /* [3] ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            position: fixed; top: 0; left: -300px; width: 260px; height: 100vh;
            background-color: white; box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease; z-index: 1050; padding-top: 80px;
            display: flex; flex-direction: column; overflow-y: auto;
        }
        .sidebar.active { left: 0; }
        .sidebar a {
            padding: 15px 30px; text-decoration: none; color: #333;
            font-size: 1.1rem; font-weight: 500; border-bottom: 1px solid #f9f9f9;
            transition: background 0.2s, color 0.2s; display: block;
        }
        .sidebar a:hover { background-color: #fafafa; color: #ab3333; font-weight: bold; }
        
        .sidebar a.menu-toggle { cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .submenu { display: none; background-color: #f8f8f8; border-bottom: 1px solid #eee; }
        .submenu.open { display: block; }
        .submenu a { padding-left: 50px; font-size: 1rem; color: #666; border-bottom: none; }
        .submenu a:hover { color: #ab3333; background-color: #f0f0f0; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); display: none; z-index: 1040;
        }
        .overlay.active { display: block; }

        /* [4] ë©”ì¸ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .hero { background-color: #ab3333; color: white; text-align: center; padding: 4rem 1rem; }
        .hero-image { max-width: 80%; width: 400px; height: auto; margin-bottom: 20px; border-radius: 12px; }
        .hero p { font-size: 1.2rem; opacity: 0.9; }

        section { padding: 3rem 2rem; max-width: 1000px; margin: 0 auto; }
        h3 { font-size: 1.8rem; color: #2c3e50; margin-bottom: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        /* [5] ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .calendar-container {
            width: 100%;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #eee;
            position: relative;
            overflow: visible;
        }

        .calendar-header {
            display: flex;
            justify-content: center; 
            align-items: center;
            background-color: #f9f9f9;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            position: relative;
            gap: 10px;
            z-index: 50; 
        }
        
        .btn-today-reset {
            padding: 5px 12px; background: white; border: 1px solid #ddd;
            border-radius: 4px; font-size: 0.9rem; cursor: pointer;
            margin-left: auto; color: #555; transition: all 0.2s;
        }
        .btn-today-reset:hover { background-color: #eee; color: #333; }

        .calendar-nav-group {
            display: flex; align-items: center; gap: 15px;
            position: absolute; left: 50%; transform: translateX(-50%);
        }

        .calendar-title {
            font-family: 'KBO_Dia', sans-serif; font-size: 1.5rem;
            color: #ab3333; cursor: pointer; position: relative;
        }
        .calendar-title:hover { text-decoration: underline; }

        /* ë‚ ì§œ ì„ íƒ íŒì—… */
        .date-picker {
            display: none; position: absolute;
            top: 100%; left: 50%; transform: translateX(-50%);
            width: 280px; height: 240px;
            background: white; border: 1px solid #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 2000; border-radius: 4px;
            flex-direction: column; text-align: left;
        }
        .date-picker.active { display: flex; }

        .picker-header {
            padding: 10px 15px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; color: #333; font-size: 0.95rem;
        }
        .picker-close { cursor: pointer; color: #999; font-size: 1.2rem; line-height: 1; }
        .picker-close:hover { color: #333; }

        .picker-body { display: flex; flex: 1; overflow: hidden; }
        .picker-col { flex: 1; overflow-y: auto; border-right: 1px solid #eee; }
        .picker-col:last-child { border-right: none; }
        .picker-col::-webkit-scrollbar { width: 6px; }
        .picker-col::-webkit-scrollbar-thumb { background-color: #ddd; border-radius: 3px; }
        .picker-col::-webkit-scrollbar-track { background-color: transparent; }
        .picker-item { padding: 8px 15px; cursor: pointer; font-size: 0.9rem; color: #555; }
        .picker-item:hover { background-color: #f5f5f5; }
        .picker-item.selected { background-color: #f0f8ff; color: #ab3333; font-weight: bold; }

        .calendar-nav-btn {
            background: none; border: none; font-size: 1.5rem;
            cursor: pointer; color: #666; transition: color 0.3s; padding: 0 5px;
        }
        .calendar-nav-btn:hover { color: #ab3333; }

        /* ë‹¬ë ¥ ë‚´ë¶€ ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ */
        .calendar-body { display: flex; flex-direction: column; width: 100%; }
        
        .weekday-row {
            display: grid; grid-template-columns: repeat(7, 1fr);
            border-bottom: 1px solid #eee; background-color: #fff;
        }
        .weekday {
            text-align: center; padding: 10px 0; font-weight: bold;
            color: #555;
        }
        .weekday.sun { color: #e74c3c; }
        .weekday.sat { color: #3498db; }

        .week-row {
            position: relative;
            min-height: 100px;
            border-bottom: 1px solid #eee;
            background-color: #fff;
        }

        /* ë‚ ì§œ ë°°ê²½ ë ˆì´ì–´ */
        .day-bg-layer {
            display: grid; grid-template-columns: repeat(7, 1fr);
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }
        .day-cell-bg {
            border-right: 1px solid #eee; padding: 5px;
            display: flex; justify-content: flex-end;
        }
        .day-cell-bg:last-child { border-right: none; }
        
        .day-number { font-size: 0.9rem; color: #333; }
        .day-cell-bg.sun .day-number { color: #e74c3c; }
        .day-cell-bg.sat .day-number { color: #3498db; }
        .day-cell-bg.other-month { background-color: #f9f9f9; }
        .day-cell-bg.other-month .day-number { color: #ccc; }
        .day-cell-bg.today { background-color: #fff5f5; }
        .day-cell-bg.today .day-number { font-weight: bold; color: #ab3333; text-decoration: underline; }

        /* ê³µíœ´ì¼ ìŠ¤íƒ€ì¼ (ì¼ìš”ì¼ê³¼ ë™ì¼í•œ ë¹¨ê°„ìƒ‰, ìš°ì„ ìˆœìœ„ ë†’ìŒ) */
        .day-cell-bg.holiday .day-number { color: #e74c3c !important; }

        /* ì¼ì • í‘œì‹œ ë ˆì´ì–´ */
        .events-layer {
            position: relative;
            z-index: 2;
            width: 100%;
            margin-top: 30px; 
            padding-bottom: 5px;
        }

        .event-bar {
            position: absolute; 
            height: 22px;
            line-height: 22px;
            border-radius: 4px;
            padding: 0 6px;
            font-size: 0.75rem;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: opacity 0.2s, transform 0.1s;
        }
        .event-bar:hover { opacity: 0.9; transform: scale(1.01); z-index: 10; }
        
        /* ìƒ‰ìƒ í´ë˜ìŠ¤ ì •ì˜ */
        .event-bar.holiday { background-color: #e74c3c; }
        .event-bar.academic { background-color: #3498db; }
        .event-bar.recruiting { background-color: #0abde3; }
        .event-bar.irregular { background-color: #e67e22; }
        .event-bar.regular { background-color: #27ae60; }
        .event-bar.etc { background-color: #7f8c8d; }

        @media (max-width: 600px) {
            .week-row { min-height: 80px; }
            .event-bar { font-size: 0.7rem; height: 20px; line-height: 20px; }
            .calendar-title { font-size: 1.2rem; }
            .btn-today-reset { font-size: 0.8rem; padding: 4px 8px; }
        }

        .activities { display: flex; gap: 20px; flex-wrap: wrap; }
        .card { flex: 1; background: #f9f9f9; padding: 25px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); min-width: 280px; }
        .card h4 { color: #ab3333; font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; }
        
        footer { background-color: #333; color: white; text-align: center; padding: 3rem 2rem 2rem; margin-top: 2rem; font-size: 0.8rem; }
        .footer-icons { display: flex; justify-content: center; gap: 20px; margin-bottom: 25px; }
        .icon-btn { display: flex; justify-content: center; align-items: center; width: 50px; height: 50px; background-color: rgba(255,255,255,0.1); border-radius: 12px; transition: all 0.3s ease; }
        .icon-btn:hover { background-color: #ab3333; transform: translateY(-3px); }
        .icon-btn img { width: 24px; height: 24px; object-fit: contain; }

        @media (max-width: 600px) {
            .hero { padding: 3rem 1rem; }
            .activities { flex-direction: column; }
            header { justify-content: flex-start; } 
        }

        /* ìƒì„¸ ëª¨ë‹¬ */
        .event-modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 3000;
            justify-content: center; align-items: center;
        }
        .event-modal {
            background: white; width: 350px; max-width: 90%;
            border-radius: 12px; padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); position: relative;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .event-modal-close {
            position: absolute; top: 15px; right: 15px;
            font-size: 1.5rem; color: #999; cursor: pointer; line-height: 1;
        }
        .event-modal-close:hover { color: #333; }
        .event-modal-badge {
            display: inline-block; padding: 5px 10px; border-radius: 20px;
            font-size: 0.8rem; font-weight: bold; color: white; margin-bottom: 10px;
        }
        .event-modal-title { font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #333; word-break: keep-all; }
        
        /* ìƒì„¸ ì •ë³´ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .event-modal-info { padding: 0; margin: 0; }
        .event-modal-info li { 
            list-style: none; margin-bottom: 8px; font-size: 0.95rem; color: #555;
            display: flex; /* Flexbox í™œì„±í™” */
            align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
        }
        .event-modal-info strong { 
            color: #333; 
            margin-right: 10px; 
            white-space: nowrap; 
            width: 75px; 
            flex-shrink: 0;
        }

        /* íŒì—… (ìƒˆí•´ ì¸ì‚¬) */
        .popup-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 9999;
            justify-content: center; align-items: center;
        }
        .popup-content {
            background: white; width: 400px; max-width: 90%;
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); text-align: center;
        }
        .popup-img-box { width: 100%; background-color: #fff; }
        .popup-img-box img { width: 100%; height: auto; display: block; }
        .popup-footer { display: flex; border-top: 1px solid #eee; }
        .popup-btn {
            flex: 1; padding: 15px; border: none; background: white; cursor: pointer;
            font-family: 'SCDream', sans-serif; font-size: 0.95rem; transition: background 0.2s;
        }
        .popup-btn:hover { background-color: #f5f5f5; }
        .btn-today { border-right: 1px solid #eee; color: #666; }
        .btn-close { color: #ab3333; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="hamburger-btn" onclick="toggleMenu()">
            <span></span><span></span><span></span>
        </div>
        <h1><a href="index.html">Providing Academic INsights for Sports.</a></h1>
    </header>

    <div class="sidebar" id="sidebar"></div>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="hero">
        <img src="PAINS_logo.png" alt="PAINS ë©”ì¸ ë¡œê³ " class="hero-image">
        <p>ê³ ë ¤ëŒ€í•™êµ êµë‚´ ìœ ì¼ ìŠ¤í¬ì¸  í†µê³„ë¶„ì„ ë™ì•„ë¦¬ PAINS</p>
    </div>

    <section>
        <h3>About Us</h3>
        <p>
            2020ë…„ ì„¤ë¦½ë˜ì–´ 2026ë…„ ì „ë°˜ê¸° 11ê¸°ë¡œ í™œë™í•˜ëŠ” PAINSëŠ” ìŠ¤í¬ì¸  í†µê³„ë¥¼ ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ì´ ëª¨ì´ëŠ” ê³³ì…ë‹ˆë‹¤.
            ì „ê³µì— ìƒê´€ì—†ì´ í†µê³„ ì§€ì‹ê³¼ ìŠ¤í¬ì¸ ì— ëŒ€í•œ ì—´ì •ë§Œ ìˆë‹¤ë©´ ëˆ„êµ¬ë“  í™˜ì˜í•©ë‹ˆë‹¤!
        </p>
    </section>

    <section>
        <h3>íšŒì¥ ì¸ì‚¬ë§</h3>
        <p>
            ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ, ê³ ë ¤ëŒ€í•™êµ ìŠ¤í¬ì¸  í†µê³„ë¶„ì„ ë™ì•„ë¦¬ PAINSì˜ íšŒì¥ ì‹ ë‹¤ì •ì…ë‹ˆë‹¤.<br><br>
            ê°ì‚¬í•©ë‹ˆë‹¤.
        </p>
    </section>

    <section>
        <h3>ì¼ì • ì•ˆë‚´</h3>
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-nav-group">
                    <button class="calendar-nav-btn" onclick="changeMonth(-1)">&#9664;</button>
                    <div class="calendar-title" id="calendar-title" onclick="toggleDatePicker()">2026. 01</div>
                    <button class="calendar-nav-btn" onclick="changeMonth(1)">&#9654;</button>

                    <div class="date-picker" id="date-picker">
                        <div class="picker-header">
                            <span>ì§ì ‘ ì„ íƒ</span>
                            <span class="picker-close" onclick="closeDatePicker()">&times;</span>
                        </div>
                        <div class="picker-body">
                            <div class="picker-col" id="picker-years"></div>
                            <div class="picker-col" id="picker-months"></div>
                        </div>
                    </div>
                </div>
                <button class="btn-today-reset" onclick="goToToday()">ì˜¤ëŠ˜</button>
            </div>
            
            <div class="calendar-body" id="calendar-body">
                <div class="weekday-row">
                    <div class="weekday sun">ì¼</div>
                    <div class="weekday">ì›”</div>
                    <div class="weekday">í™”</div>
                    <div class="weekday">ìˆ˜</div>
                    <div class="weekday">ëª©</div>
                    <div class="weekday">ê¸ˆ</div>
                    <div class="weekday sat">í† </div>
                </div>
                </div>
        </div>
    </section>

    <section>
        <h3>Our Activities</h3>
        <div class="activities">
            <div class="card">
                <h4>ğŸ“š ì •ê¸° ìŠ¤í„°ë””</h4>
                <p>ì§€ì›ìë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ê´€ì‹¬ ë¶„ì•¼ë³„ ì‹¬ë„ ìˆëŠ” ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="card">
                <h4>ğŸ¤ í”„ë¡œì íŠ¸</h4>
                <p>ë°°ìš´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•™ê¸° ì¤‘, ë°©í•™ ì¤‘ì— í•œ ë²ˆì”© ì •ê¸° íŒ€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ì‹¤ì „ ê²½í—˜ì„ ìŒ“ìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="card">
                <h4>ğŸ‰ ì¹œëª© í™œë™</h4>
                <p>ì„ í›„ë°° ë° ë¶€ì› ê°„ êµë¥˜ í™œë™. MT, ì†¡ë…„íšŒ ë“± ë‹¤ì–‘í•œ ì¹œëª© í™œë™ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-icons">
            <a href="https://www.instagram.com/ku_pains" target="_blank" class="icon-btn" title="Instagram">
                <img src="instagram.png" alt="Instagram">
            </a>
            <a href="https://www.notion.so/painsports/PAINS-a9294ba2a44b4ea6a53f0d5ae069749e" target="_blank" class="icon-btn" title="Notion">
                <img src="notion.png" alt="Notion">
            </a>
            <a href="https://blog.naver.com/painsports" target="_blank" class="icon-btn" title="Blog">
                <img src="naver_blog.png" alt="NaverBlog">
            </a>
        </div>
        <p>&copy; 2026 PAINS. All rights reserved.</p>
    </footer>

    <div id="event-modal-overlay" class="event-modal-overlay" onclick="closeEventModal()">
        <div class="event-modal" onclick="event.stopPropagation()">
            <span class="event-modal-close" onclick="closeEventModal()">&times;</span>
            <div id="modal-badge" class="event-modal-badge"></div>
            <div id="modal-title" class="event-modal-title"></div>
            <ul class="event-modal-info">
                <li id="li-date"><strong>ğŸ“… ì¼ì‹œ:</strong> <span id="modal-date"></span></li>
                <li id="li-time"><strong>â° ì‹œê°:</strong> <span id="modal-time"></span></li>
                <li id="li-location"><strong>ğŸ“ ì¥ì†Œ:</strong> <span id="modal-location"></span></li>
            </ul>
        </div>
    </div>

    <div id="img-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-img-box">
                <img src="2026 HAPPY NEW YEAR.png" alt="2026 ìƒˆí•´ ë³µ ë§ì´ ë°›ìœ¼ì„¸ìš”">
            </div>
            <div class="popup-footer">
                <button class="popup-btn btn-today" onclick="closePopupToday()">ì˜¤ëŠ˜ í•˜ë£¨ ì•ˆ ë³´ê¸°</button>
                <button class="popup-btn btn-close" onclick="closePopup()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        document.write('<script src="menu.js?v=' + new Date().getTime() + '"><\/script>');
    </script>

    <script>
        loadSidebar('home');

        // ============================================
        // íŒì—… ë¡œì§
        // ============================================
        document.addEventListener("DOMContentLoaded", function() {
            const popup = document.getElementById('img-popup');
            const hideDate = localStorage.getItem('pains_popup_hide_date');
            const today = new Date().toDateString();
            if (hideDate !== today) { popup.style.display = "flex"; }
        });
        function closePopup() { document.getElementById('img-popup').style.display = "none"; }
        function closePopupToday() {
            localStorage.setItem('pains_popup_hide_date', new Date().toDateString());
            closePopup();
        }

        // ============================================
        // ê³µíœ´ì¼ ê³„ì‚° ë¡œì§ (2020~2040 ë°ì´í„° í™•ì¥)
        // ============================================
        function getKoreanHolidays(year) {
            const holidays = new Set();
            
            // 1. ì–‘ë ¥ ê³ ì • ê³µíœ´ì¼
            const solarHolidays = [
                '01-01', '03-01', '05-05', '06-06', '08-15', '10-03', '10-09', '12-25'
            ];
            solarHolidays.forEach(date => holidays.add(`${year}-${date}`));

            // 2. ìŒë ¥ ëª…ì ˆ ë° ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚  (ì–‘ë ¥ ë³€í™˜ ë°ì´í„°: 2020~2040)
            const lunarMap = {
                2020: { seol: '01-25', buddha: '04-30', chuseok: '10-01' },
                2021: { seol: '02-12', buddha: '05-19', chuseok: '09-21' },
                2022: { seol: '02-01', buddha: '05-08', chuseok: '09-10' },
                2023: { seol: '01-22', buddha: '05-27', chuseok: '09-29' },
                2024: { seol: '02-10', buddha: '05-15', chuseok: '09-17' },
                2025: { seol: '01-29', buddha: '05-05', chuseok: '10-06' },
                2026: { seol: '02-17', buddha: '05-24', chuseok: '09-25' },
                2027: { seol: '02-07', buddha: '05-13', chuseok: '09-15' },
                2028: { seol: '01-27', buddha: '05-02', chuseok: '10-03' },
                2029: { seol: '02-13', buddha: '05-20', chuseok: '09-22' },
                2030: { seol: '02-03', buddha: '05-09', chuseok: '09-12' },
                2031: { seol: '01-23', buddha: '05-28', chuseok: '10-01' },
                2032: { seol: '02-11', buddha: '05-16', chuseok: '09-19' },
                2033: { seol: '01-31', buddha: '05-06', chuseok: '10-07' },
                2034: { seol: '02-19', buddha: '05-25', chuseok: '09-27' },
                2035: { seol: '02-08', buddha: '05-15', chuseok: '09-16' },
                2036: { seol: '01-28', buddha: '05-02', chuseok: '10-04' },
                2037: { seol: '02-15', buddha: '05-22', chuseok: '09-24' },
                2038: { seol: '02-04', buddha: '05-11', chuseok: '09-13' },
                2039: { seol: '01-24', buddha: '05-02', chuseok: '10-02' },
                2040: { seol: '02-12', buddha: '05-18', chuseok: '09-21' }
            };

            if (lunarMap[year]) {
                const map = lunarMap[year];
                
                // ì„¤ë‚  (ì „ë‚ , ë‹¹ì¼, ë‹¤ìŒë‚ )
                const seol = new Date(`${year}-${map.seol}`);
                [ -1, 0, 1 ].forEach(offset => {
                    const d = new Date(seol);
                    d.setDate(d.getDate() + offset);
                    holidays.add(getFmtDate(d));
                });

                // ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ 
                holidays.add(`${year}-${map.buddha}`);

                // ì¶”ì„ (ì „ë‚ , ë‹¹ì¼, ë‹¤ìŒë‚ )
                const chuseok = new Date(`${year}-${map.chuseok}`);
                [ -1, 0, 1 ].forEach(offset => {
                    const d = new Date(chuseok);
                    d.setDate(d.getDate() + offset);
                    holidays.add(getFmtDate(d));
                });
            }

            // 3. ëŒ€ì²´ê³µíœ´ì¼ ê³„ì‚°
            let sortedHolidays = Array.from(holidays).sort();
            
            sortedHolidays.forEach(dateStr => {
                const dateParts = dateStr.split('-');
                const md = `${dateParts[1]}-${dateParts[2]}`; // MM-DD
                const dateObj = new Date(dateStr);
                const day = dateObj.getDay(); // 0:ì¼, 6:í† 

                let isSubstituteTarget = false;
                
                // ê·¸ë£¹ A: í† /ì¼ ê²¹ì¹˜ë©´ ëŒ€ì²´ (ì–´ë¦°ì´ë‚ , 3.1, 8.15, 10.3, 10.9, 12.25, ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ )
                const groupA = ['03-01', '05-05', '08-15', '10-03', '10-09', '12-25'];
                if (lunarMap[year] && md === lunarMap[year].buddha) isSubstituteTarget = true;
                if (groupA.includes(md)) isSubstituteTarget = true;

                if (isSubstituteTarget && (day === 0 || day === 6)) {
                    addSubstitute(dateObj, holidays);
                }

                // ê·¸ë£¹ B: ì¼ìš”ì¼ë§Œ ê²¹ì¹˜ë©´ ëŒ€ì²´ (ì„¤ë‚ , ì¶”ì„ ì—°íœ´)
                if (lunarMap[year]) {
                    const seolMain = new Date(`${year}-${lunarMap[year].seol}`);
                    const chuseokMain = new Date(`${year}-${lunarMap[year].chuseok}`);
                    
                    if (isNearDate(dateObj, seolMain) || isNearDate(dateObj, chuseokMain)) {
                        if (day === 0) { 
                            addSubstitute(dateObj, holidays);
                        }
                    }
                }
            });

            return holidays;
        }

        // ë‚ ì§œê°€ ê¸°ì¤€ì¼ì˜ ì „í›„ 1ì¼ ë²”ìœ„ ë‚´ì¸ì§€ í™•ì¸ (ì„¤/ì¶”ì„ ì—°íœ´ íŒë³„ìš©)
        function isNearDate(target, center) {
            const diff = (target - center) / (1000 * 60 * 60 * 24);
            return Math.abs(diff) <= 1.1; // ì˜¤ì°¨ ê°ì•ˆ
        }

        // ëŒ€ì²´ê³µíœ´ì¼ ì¶”ê°€ í•¨ìˆ˜ (ë‹¤ìŒ ë¹„ê³µíœ´ì¼ ì°¾ê¸°)
        function addSubstitute(fromDate, holidaySet) {
            let nextDate = new Date(fromDate);
            while (true) {
                nextDate.setDate(nextDate.getDate() + 1);
                const nextStr = getFmtDate(nextDate);
                if (!holidaySet.has(nextStr)) {
                    holidaySet.add(nextStr);
                    break;
                }
            }
        }

        function getFmtDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // ============================================
        // ë‹¬ë ¥ ë¡œì§
        // ============================================
        
        let allEvents = []; 
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1; 
        const todayObj = new Date();
        let pickerSelectedYear = currentYear;

        const GOOGLESHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRBnuUvyE2CDV-hG26xCVdnt88JhQgtusdEndJwTzaI62TXPdWTNldVvua9RLkXj1s34qiM0CEcNvbr/pub?gid=305458048&single=true&output=csv";

        async function fetchAndInitCalendar() {
            try {
                const response = await fetch(GOOGLESHEET_URL);
                const data = await response.text();
                const rows = data.split("\n").map(row => row.trim()).filter(row => row.length > 0);
                
                allEvents = rows.slice(1).map(row => {
                    const cols = row.split(",");
                    if (cols.length < 7) return null;
                    
                    return {
                        name: cols[0].trim(),
                        startDate: cols[1].trim(),
                        startTime: cols[2].trim(),
                        endDate: cols[3].trim() || cols[1].trim(), 
                        endTime: cols[4].trim(),
                        location: cols[5].trim(),
                        type: cols[6].trim()
                    };
                }).filter(event => event !== null); 

                renderCalendar(currentYear, currentMonth);

            } catch (error) {
                console.error("ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                document.getElementById('calendar-title').innerText = "ì¼ì • ë¡œë”© ì‹¤íŒ¨";
            }
        }

        function renderCalendar(year, month) {
            const calendarBody = document.getElementById('calendar-body');
            const title = document.getElementById('calendar-title');
            
            title.innerText = `${year}. ${String(month).padStart(2, '0')}`;

            const oldRows = calendarBody.querySelectorAll('.week-row');
            oldRows.forEach(r => r.remove());

            // [ìˆ˜ì •] í•´ë‹¹ ì—°ë„ì˜ ê³µíœ´ì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const holidaySet = getKoreanHolidays(year);

            const firstDateOfMonth = new Date(year, month - 1, 1);
            const lastDateOfMonth = new Date(year, month, 0);
            
            const startDate = new Date(firstDateOfMonth);
            startDate.setDate(startDate.getDate() - firstDateOfMonth.getDay()); 

            const endDate = new Date(lastDateOfMonth);
            if (endDate.getDay() !== 6) {
                endDate.setDate(endDate.getDate() + (6 - endDate.getDay()));
            }

            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                const weekRow = document.createElement('div');
                weekRow.className = 'week-row';

                const dayBgLayer = document.createElement('div');
                dayBgLayer.className = 'day-bg-layer';

                const eventsLayer = document.createElement('div');
                eventsLayer.className = 'events-layer';

                let weekDates = []; 

                for (let i = 0; i < 7; i++) {
                    const d = new Date(currentDate);
                    weekDates.push(d);

                    const bgCell = document.createElement('div');
                    bgCell.className = 'day-cell-bg';
                    
                    if (d.getMonth() + 1 !== month) bgCell.classList.add('other-month');
                    if (d.getDay() === 0) bgCell.classList.add('sun');
                    if (d.getDay() === 6) bgCell.classList.add('sat');
                    
                    // [ìˆ˜ì •] ê³µíœ´ì¼ ì²´í¬
                    const dateStr = getFmtDate(d);
                    if (holidaySet.has(dateStr)) {
                        bgCell.classList.add('holiday');
                    }

                    if (d.getFullYear() === todayObj.getFullYear() &&
                        d.getMonth() === todayObj.getMonth() &&
                        d.getDate() === todayObj.getDate()) {
                        bgCell.classList.add('today');
                    }

                    const numSpan = document.createElement('span');
                    numSpan.className = 'day-number';
                    numSpan.innerText = d.getDate();
                    
                    bgCell.appendChild(numSpan);
                    dayBgLayer.appendChild(bgCell);

                    currentDate.setDate(currentDate.getDate() + 1); 
                }

                // ì´ë²¤íŠ¸ ë°°ì¹˜ ë¡œì§
                const weekStart = weekDates[0].getTime();
                const weekEnd = weekDates[6].getTime();
                
                let weekEvents = allEvents.filter(evt => {
                    const [sy, sm, sd] = evt.startDate.split('-').map(Number);
                    const sTime = new Date(sy, sm-1, sd).getTime();
                    const [ey, em, ed] = evt.endDate.split('-').map(Number);
                    const eTime = new Date(ey, em-1, ed).getTime();

                    return sTime <= weekEnd && eTime >= weekStart;
                }).map(evt => {
                    const [sy, sm, sd] = evt.startDate.split('-').map(Number);
                    const sDate = new Date(sy, sm-1, sd);
                    const [ey, em, ed] = evt.endDate.split('-').map(Number);
                    const eDate = new Date(ey, em-1, ed);

                    let startIndex = 0;
                    if (sDate > weekDates[0]) {
                        startIndex = Math.floor((sDate - weekDates[0]) / (1000 * 60 * 60 * 24));
                    }
                    
                    let endIndex = 6;
                    if (eDate < weekDates[6]) {
                        endIndex = 6 - Math.floor((weekDates[6] - eDate) / (1000 * 60 * 60 * 24));
                    }

                    const span = endIndex - startIndex + 1;

                    return {
                        original: evt,
                        startIndex,
                        endIndex,
                        span,
                        sDate,
                        eDate,
                        duration: eDate - sDate 
                    };
                });

                weekEvents.sort((a, b) => {
                    if (a.startIndex !== b.startIndex) return a.startIndex - b.startIndex;
                    return b.duration - a.duration;
                });

                let slots = []; 

                weekEvents.forEach(evt => {
                    let row = 0;
                    while (true) {
                        if (!slots[row]) slots[row] = Array(7).fill(false);
                        
                        let isClear = true;
                        for (let d = evt.startIndex; d <= evt.endIndex; d++) {
                            if (slots[row][d]) {
                                isClear = false;
                                break;
                            }
                        }

                        if (isClear) {
                            for (let d = evt.startIndex; d <= evt.endIndex; d++) {
                                slots[row][d] = true;
                            }
                            evt.row = row; 
                            break;
                        }
                        row++;
                    }
                });

                const maxRow = slots.length; 
                if (maxRow > 0) {
                    const minH = 100;
                    const contentH = 30 + (maxRow * 24) + 10; 
                    if (contentH > minH) {
                        weekRow.style.minHeight = contentH + 'px';
                    }
                }

                weekEvents.forEach(evt => {
                    const bar = document.createElement('div');
                    bar.innerText = evt.original.name;
                    bar.className = 'event-bar';
                    
                    // ìƒ‰ìƒ ì¡°ê±´
                    if (evt.original.type.includes('ê³µíœ´ì¼')) bar.classList.add('holiday');
                    else if (evt.original.type.includes('í•™ì‚¬ì¼ì •')) bar.classList.add('academic');
                    else if (evt.original.type.includes('ë¦¬í¬ë£¨íŒ…')) bar.classList.add('recruiting');
                    else if (evt.original.type.includes('ë¹„ì •ê¸°')) bar.classList.add('irregular');
                    else if (evt.original.type.includes('ì •ê¸°')) bar.classList.add('regular');
                    else bar.classList.add('etc');

                    bar.style.top = (evt.row * 24) + 'px';
                    
                    const ONE_DAY_PCT = 14.2857; 
                    const GAP = 0.5; 

                    let leftPct = evt.startIndex * ONE_DAY_PCT;
                    let widthPct = evt.span * ONE_DAY_PCT;

                    const isStartInWeek = (evt.sDate >= weekDates[0]); 
                    const isEndInWeek = (evt.eDate <= weekDates[6]);    

                    if (isStartInWeek) {
                        leftPct += GAP;
                        widthPct -= GAP;
                    }
                    if (isEndInWeek) {
                        widthPct -= GAP;
                    }

                    bar.style.left = leftPct + '%';
                    bar.style.width = widthPct + '%';

                    if (!isStartInWeek) {
                        bar.style.borderTopLeftRadius = '0';
                        bar.style.borderBottomLeftRadius = '0';
                    }
                    if (!isEndInWeek) {
                        bar.style.borderTopRightRadius = '0';
                        bar.style.borderBottomRightRadius = '0';
                    }

                    bar.onclick = (e) => {
                        e.stopPropagation();
                        openEventModal(evt.original);
                    };

                    eventsLayer.appendChild(bar);
                });

                weekRow.appendChild(dayBgLayer);
                weekRow.appendChild(eventsLayer);
                calendarBody.appendChild(weekRow);
            }
        }

        // ============================================
        // ìƒì„¸ ëª¨ë‹¬ ë¡œì§
        // ============================================
        function openEventModal(evt) {
            const modal = document.getElementById('event-modal-overlay');
            const badge = document.getElementById('modal-badge');
            const title = document.getElementById('modal-title');
            const date = document.getElementById('modal-date');
            const time = document.getElementById('modal-time');
            const loc = document.getElementById('modal-location');
            const liDate = document.getElementById('li-date');
            const liTime = document.getElementById('li-time');
            const liLocation = document.getElementById('li-location'); 

            // 1. ë±ƒì§€
            badge.innerText = evt.type || "ê¸°íƒ€";
            badge.className = "event-modal-badge"; 
            
            if (evt.type.includes('ê³µíœ´ì¼')) badge.style.backgroundColor = "#e74c3c";
            else if (evt.type.includes('í•™ì‚¬ì¼ì •')) badge.style.backgroundColor = "#3498db";
            else if (evt.type.includes('ë¦¬í¬ë£¨íŒ…')) badge.style.backgroundColor = "#0abde3";
            else if (evt.type.includes('ë¹„ì •ê¸°')) badge.style.backgroundColor = "#e67e22";
            else if (evt.type.includes('ì •ê¸°')) badge.style.backgroundColor = "#27ae60";
            else badge.style.backgroundColor = "#7f8c8d";

            // 2. ì œëª©
            title.innerText = evt.name;
            
            // 3. ì¼ì‹œ ë° ì‹œê° ì²˜ë¦¬ ë¡œì§
            const sDateStr = formatModalDate(evt.startDate);
            const eDateStr = formatModalDate(evt.endDate);
            const sTime = evt.startTime ? evt.startTime.trim() : "";
            const eTime = evt.endTime ? evt.endTime.trim() : "";

            const isInvalidTime = (t) => !t || ["TBC", "TBD", "ë¯¸ì •", "TBA"].includes(t.toUpperCase());
            const hasValidTime = !isInvalidTime(sTime) || !isInvalidTime(eTime);

            liTime.style.display = "none"; 

            if (evt.startDate !== evt.endDate) {
                // [2ì¼ ì´ìƒ ì¼ì •]
                let startPart = sDateStr;
                let endPart = eDateStr;

                if (hasValidTime) {
                     startPart += ` ${isInvalidTime(sTime) ? '' : sTime}`;
                     endPart += ` ${isInvalidTime(eTime) ? '' : eTime}`;
                }
                date.innerHTML = `${startPart} -<br>${endPart}`;

            } else {
                // [1ì¼ ì¼ì •]
                date.innerText = sDateStr;

                if (hasValidTime) {
                    liTime.style.display = "flex"; 
                    if(sTime && eTime) time.innerText = `${sTime} ~ ${eTime}`;
                    else if(sTime) time.innerText = sTime + " ~";
                    else time.innerText = "~ " + eTime;
                }
            }

            // 4. ì¥ì†Œ ì²˜ë¦¬
            if (evt.location && evt.location.trim() !== "") {
                liLocation.style.display = "flex";
                loc.innerText = evt.location;
            } else {
                liLocation.style.display = "none";
            }
            
            modal.style.display = "flex";
        }

        function closeEventModal() {
            document.getElementById('event-modal-overlay').style.display = "none";
        }

        function formatModalDate(dateStr) {
            if (!dateStr) return "";
            const [y, m, d] = dateStr.split('-');
            const date = new Date(y, m - 1, d);
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            return `${y}. ${m}. ${d}. (${days[date.getDay()]})`;
        }

        // ============================================
        // ê¸°íƒ€ ìœ í‹¸ë¦¬í‹°
        // ============================================
        function goToToday() {
            currentYear = todayObj.getFullYear();
            currentMonth = todayObj.getMonth() + 1;
            renderCalendar(currentYear, currentMonth);
        }

        function changeMonth(step) {
            currentMonth += step;
            if (currentMonth < 1) { currentMonth = 12; currentYear--; } 
            else if (currentMonth > 12) { currentMonth = 1; currentYear++; }
            renderCalendar(currentYear, currentMonth);
        }

        function toggleDatePicker(e) {
            const picker = document.getElementById('date-picker');
            if(e) e.stopPropagation();
            if (picker.classList.contains('active')) {
                closeDatePicker();
            } else {
                pickerSelectedYear = currentYear; 
                renderPickerContent();
                picker.classList.add('active');
                document.addEventListener('click', closeDatePickerOutside);
            }
        }

        function closeDatePicker() {
            const picker = document.getElementById('date-picker');
            picker.classList.remove('active');
            document.removeEventListener('click', closeDatePickerOutside);
        }

        function closeDatePickerOutside(event) {
            const picker = document.getElementById('date-picker');
            const title = document.getElementById('calendar-title');
            if (!picker.contains(event.target) && !title.contains(event.target)) {
                closeDatePicker();
            }
        }

        function renderPickerContent() {
            const yearCol = document.getElementById('picker-years');
            const monthCol = document.getElementById('picker-months');
            
            yearCol.innerHTML = ''; monthCol.innerHTML = '';
            
            for (let y = 2020; y <= 2030; y++) {
                const div = document.createElement('div');
                div.className = 'picker-item'; div.innerText = y + 'ë…„';
                if (y === pickerSelectedYear) div.classList.add('selected');
                div.onclick = (e) => { e.stopPropagation(); pickerSelectedYear = y; renderPickerContent(); };
                yearCol.appendChild(div);
            }
            setTimeout(() => {
                const selectedEl = yearCol.querySelector('.selected');
                if(selectedEl) selectedEl.scrollIntoView({block: "center"});
            }, 0);

            for (let m = 1; m <= 12; m++) {
                const div = document.createElement('div');
                div.className = 'picker-item'; div.innerText = m + 'ì›”';
                if (pickerSelectedYear === currentYear && m === currentMonth) div.classList.add('selected');
                div.onclick = (e) => { e.stopPropagation(); currentYear = pickerSelectedYear; currentMonth = m; renderCalendar(currentYear, currentMonth); closeDatePicker(); };
                monthCol.appendChild(div);
            }
        }

        fetchAndInitCalendar();
    </script>

</body>
</html>
